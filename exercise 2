import sqlite3


def create_database_and_table():
    conn = sqlite3.connect('stephen_king_adaptations.db')
    cursor = conn.cursor()
    cursor.execute('''CREATE TABLE IF NOT EXISTS stephen_king_adaptations_table (
                      movieID INTEGER PRIMARY KEY AUTOINCREMENT,
                      movieName TEXT,
                      movieYear INTEGER,
                      imdbRating REAL)''')
    conn.commit()
    conn.close()


def insert_data_from_file_to_db(filename):
    try:
        with open(filename, 'r') as file:
            data = file.readlines()
        conn = sqlite3.connect('stephen_king_adaptations.db')
        cursor = conn.cursor()
        for line in data:
            parts = line.strip().split(',')
            if len(parts) == 4:
                cursor.execute('INSERT INTO stephen_king_adaptations_table (movieName, movieYear, imdbRating) VALUES (?, ?, ?)',
                               (parts[0], int(parts[1]), float(parts[3])))
        conn.commit()
        conn.close()
    except FileNotFoundError:
        print(f"The file '{filename}' was not found.")


def search_movies():
    conn = sqlite3.connect('stephen_king_adaptations.db')
    cursor = conn.cursor()
    
    while True:
        print("\nOptions:")
        print("1. Search by Movie Name")
        print("2. Search by Movie Year")
        print("3. Search by Movie Rating")
        print("4. STOP")
        choice = input("Enter your choice: ")
        
        if choice == '1':
            movie_name = input("Enter the movie name: ")
            cursor.execute('SELECT * FROM stephen_king_adaptations_table WHERE movieName = ?', (movie_name,))
            result = cursor.fetchall()
            if result:
                for row in result:
                    print(f"Movie Name: {row[1]}, Year: {row[2]}, IMDb Rating: {row[3]}")
            else:
                print("No such movie exists in our database.")
        
        elif choice == '2':
            movie_year = input("Enter the movie year: ")
            cursor.execute('SELECT * FROM stephen_king_adaptations_table WHERE movieYear = ?', (movie_year,))
            result = cursor.fetchall()
            if result:
                for row in result:
                    print(f"Movie Name: {row[1]}, Year: {row[2]}, IMDb Rating: {row[3]}")
            else:
                print("No movies were found for that year in our database.")
        
        elif choice == '3':
            rating_limit = input("Enter the minimum IMDb rating: ")
            cursor.execute('SELECT * FROM stephen_king_adaptations_table WHERE imdbRating >= ?', (float(rating_limit),))
            result = cursor.fetchall()
            if result:
                for row in result:
                    print(f"Movie Name: {row[1]}, Year: {row[2]}, IMDb Rating: {row[3]}")
            else:
                print("No movies at or above that rating were found in the database.")
        
        elif choice == '4':
            break

        else:
            print("Invalid choice. Please select a valid option.")

    conn.close()

if __name__ == "__main__":
    create_database_and_table()
    insert_data_from_file_to_db("stephen_king_adaptations.txt")
    search_movies()
